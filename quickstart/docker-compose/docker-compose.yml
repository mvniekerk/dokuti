version: '3'
services:
  dokuti-quickstart:
    build: ../../
    ports:
     - "8181:8080"
    volumes:
      - ./sample-application.yaml:/config/application.yaml
      - ./files:/tmp/dokuti-local-uploads
  dokuti-postgresql-quickstart:
    networks:
      - dokuti-quickstart
    image: "bitnami/postgresql:10.7.0"
    ports:
      - '5432:5432'
    environment:
      - POSTGRESQL_PASSWORD=postgres
      - POSTGRESQL_DATABASE=dokuti
    ## To persist database
    # volumes:
    #   - 'postgresql_data:/bitnami'
  dokuti-identity-server-quickstart:
    networks:
      - dokuti-quickstart
    image: "baobab/identityserver"
    restart: always
    ports:
      - 8080:80
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    volumes:
      - ./identity-server-appsettings.json:/app/appsettings.json
    depends_on:
      - as3-quickstart-postgresql
    command: sh -c './wait-for.sh dokuti-postgresql-quickstart:5432 -- '
  dokuti-a3s-quickstart:
    networks:
      - dokuti-quickstart
    image: "baobab/a3s"
    restart: always
    ports:
      - 8081:80
    volumes:
      - ./a3s-appsettings.json:/app/appsettings.json
    depends_on:
      - as3-quickstart-postgresql
      - a3s-quickstart-identity_server
    command: sh -c './wait-for.sh dokuti-postgresql-quickstart:5432 -- '
    
networks:
  dokuti-quickstart: